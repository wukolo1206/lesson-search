<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“š åœ‹èªå‚™èª²æœå°‹å¼•æ“</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    :root {
      --primary: #2563eb;
      --primary-light: #dbeafe;
      --purple: #7c3aed;
      --green: #059669;
      --amber: #d97706;
      --red: #dc2626;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --shadow: 0 1px 3px rgba(0,0,0,.10), 0 1px 2px rgba(0,0,0,.06);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,.10);
      --radius: 12px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
      background: var(--gray-50); color: var(--gray-800); min-height: 100vh;
    }

    /* â”€â”€ è¼‰å…¥ç•«é¢ â”€â”€ */
    #loading {
      position: fixed; inset: 0; background: white;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 1000; gap: 16px;
    }
    .spinner {
      width: 52px; height: 52px;
      border: 4px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin .8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-title { font-size: 1.1rem; color: var(--gray-700); font-weight: 600; }
    .loading-steps { display: flex; flex-direction: column; gap: 6px; margin-top: 4px; }
    .step {
      display: flex; align-items: center; gap: 8px;
      font-size: .875rem; color: var(--gray-600);
      opacity: .35; transition: opacity .3s, color .3s;
    }
    .step.active { opacity: 1; color: var(--primary); }
    .step.done   { opacity: 1; color: var(--green); }
    .step-icon   { width: 18px; text-align: center; }

    /* â”€â”€ é é¦– â”€â”€ */
    header {
      background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);
      color: white; padding: 22px 32px;
    }
    header h1 { font-size: 1.6rem; font-weight: 700; margin-bottom: 4px; }
    header p  { opacity: .85; font-size: .9rem; }

    /* â”€â”€ ç¯©é¸åˆ— â”€â”€ */
    .filter-bar {
      background: white; border-bottom: 1px solid var(--gray-200);
      padding: 14px 32px; display: flex; flex-wrap: wrap;
      gap: 10px; align-items: center;
      position: sticky; top: 0; z-index: 100;
      box-shadow: var(--shadow);
    }
    .fg { display: flex; align-items: center; gap: 5px; }
    .fg label { font-size: .78rem; color: var(--gray-600); white-space: nowrap; font-weight: 500; }
    select, .search-input {
      border: 1px solid var(--gray-200); border-radius: 8px;
      padding: 5px 9px; font-size: .85rem; color: var(--gray-700);
      background: var(--gray-50); outline: none;
      transition: border-color .2s, background .2s;
    }
    select:focus, .search-input:focus {
      border-color: var(--primary); background: white;
    }
    .search-input { width: 190px; }
    .btn-reset {
      padding: 5px 14px; border: 1px solid var(--gray-200);
      background: var(--gray-100); border-radius: 8px;
      cursor: pointer; font-size: .85rem; color: var(--gray-600);
      transition: background .15s;
    }
    .btn-reset:hover { background: var(--gray-200); }

    /* â”€â”€ çµ±è¨ˆåˆ— â”€â”€ */
    .stats-bar {
      padding: 10px 32px; font-size: .85rem;
      color: var(--gray-600); display: flex; gap: 12px;
    }
    .count { font-weight: 700; color: var(--primary); }

    /* â”€â”€ å¡ç‰‡æ ¼ â”€â”€ */
    main { padding: 4px 32px 40px; max-width: 1440px; margin: 0 auto; }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(390px, 1fr));
      gap: 18px;
    }

    /* â”€â”€ å¡ç‰‡ â”€â”€ */
    .card {
      background: white; border-radius: var(--radius);
      border: 1px solid var(--gray-200); box-shadow: var(--shadow);
      overflow: hidden; transition: transform .18s, box-shadow .18s;
    }
    .card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

    .card-head {
      padding: 13px 16px 9px;
      border-bottom: 1px solid var(--gray-100);
      display: flex; flex-wrap: wrap; gap: 5px; align-items: center;
    }
    .card-title {
      font-size: .95rem; font-weight: 600;
      color: var(--gray-800); width: 100%; margin-top: 6px;
    }

    /* å¾½ç«  */
    .badge {
      display: inline-flex; align-items: center;
      padding: 1px 7px; border-radius: 20px;
      font-size: .72rem; font-weight: 600;
    }
    .b-g3 { background: #dbeafe; color: #1e40af; }
    .b-g4 { background: #d1fae5; color: #065f46; }
    .b-g5 { background: #fef3c7; color: #92400e; }
    .b-g6 { background: #fce7f3; color: #9d174d; }
    .b-yr { background: var(--gray-100); color: var(--gray-600); }
    .b-ct { background: #ede9fe; color: #4c1d95; }
    .b-ez { background: #d1fae5; color: #065f46; }
    .b-md { background: #fef3c7; color: #92400e; }
    .b-hd { background: #fee2e2; color: #991b1b; }

    /* å¡ç‰‡å…§å®¹ */
    .card-body { padding: 13px 16px; display: flex; flex-direction: column; gap: 10px; }

    .q-box {
      background: var(--gray-50); border: 1px solid var(--gray-200);
      border-radius: 8px; padding: 9px 11px;
      font-size: .84rem; line-height: 1.65;
      color: var(--gray-700); white-space: pre-wrap; word-break: break-all;
    }
    .sec { display: flex; flex-direction: column; gap: 3px; }
    .sec-lbl {
      font-size: .73rem; font-weight: 600;
      color: var(--gray-600); display: flex; align-items: center; gap: 3px;
    }
    .sec-body { font-size: .84rem; color: var(--gray-700); line-height: 1.55; }

    .box-y { background:#fffbeb; border-left:3px solid #f59e0b; padding:7px 10px; border-radius:0 6px 6px 0; font-size:.84rem; line-height:1.55; }
    .box-g { background:#f0fdf4; border-left:3px solid #22c55e; padding:7px 10px; border-radius:0 6px 6px 0; font-size:.84rem; line-height:1.55; }
    .box-b { background:#eff6ff; border-left:3px solid #3b82f6; padding:7px 10px; border-radius:0 6px 6px 0; font-size:.84rem; line-height:1.55; }

    /* å±•é–‹åˆ— */
    .exp-btn {
      display: flex; align-items: center; justify-content: space-between;
      padding: 9px 16px; background: none;
      border: none; border-top: 1px solid var(--gray-100);
      width: 100%; cursor: pointer;
      font-size: .79rem; color: var(--gray-600); font-weight: 500;
      transition: background .12s;
    }
    .exp-btn:hover { background: var(--gray-50); }
    .arrow { transition: transform .2s; display: inline-block; }
    .exp-btn.open .arrow { transform: rotate(180deg); }
    .exp-body {
      display: none; padding: 12px 16px;
      border-top: 1px solid var(--gray-100);
      background: var(--gray-50); font-size: .83rem;
    }
    .exp-body.open { display: block; }

    /* ç´°ç›®è¡¨æ ¼ */
    .tbl { width:100%; border-collapse:collapse; font-size:.8rem; margin-top:4px; }
    .tbl th { background:var(--gray-200); padding:5px 7px; text-align:left; color:var(--gray-600); font-weight:600; }
    .tbl td { padding:5px 7px; border-bottom:1px solid var(--gray-200); vertical-align:top; }
    .tbl tr:last-child td { border-bottom:none; }
    .row-ok  { background:#f0fdf4; }
    .row-err { background:#fff1f2; }

    /* æ•™æå¡ */
    .mat-card {
      background:white; border:1px solid var(--gray-200);
      border-radius:8px; padding:11px;
      display:flex; flex-direction:column; gap:5px;
    }
    .mat-title { font-weight:700; color:var(--primary); font-size:.88rem; }
    .mat-row   { font-size:.79rem; color:var(--gray-700); }
    .mat-row strong { color:var(--gray-600); }

    /* ç©ºçµæœ */
    .empty {
      text-align:center; padding:60px 20px;
      color:var(--gray-600); grid-column:1/-1;
    }
    .empty .icon { font-size:3rem; margin-bottom:10px; }

    /* éŒ¯èª¤ç•«é¢ */
    .error-screen {
      display:flex; flex-direction:column; align-items:center;
      justify-content:center; gap:12px; padding:40px;
      text-align:center;
    }
    .error-screen .icon { font-size:2.5rem; }

    @media(max-width:700px){
      header { padding:16px; }
      .filter-bar { padding:12px 16px; }
      main { padding:4px 14px 28px; }
      .stats-bar { padding:8px 14px; }
      .card-grid { grid-template-columns:1fr; }
      .search-input { width:150px; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ è¼‰å…¥ç•«é¢ â”€â”€ -->
<div id="loading">
  <div class="spinner"></div>
  <div class="loading-title">æ­£åœ¨è¼‰å…¥æ•™å­¸è³‡æ–™åº«â€¦</div>
  <div class="loading-steps">
    <div class="step" id="s1"><span class="step-icon">ğŸ“‹</span>é¡Œç›®ä¸»è¡¨</div>
    <div class="step" id="s2"><span class="step-icon">ğŸ“š</span>æ•™æè³‡æ–™åº«</div>
    <div class="step" id="s3"><span class="step-icon">ğŸ”¤</span>ç ´éŸ³å­—ç´°ç›®</div>
    <div class="step" id="s4"><span class="step-icon">âœï¸</span>éŒ¯åˆ¥å­—ç´°ç›®</div>
    <div class="step" id="s5"><span class="step-icon">ğŸ”</span>å½¢è¿‘å­—ç´°ç›®</div>
    <div class="step" id="s6"><span class="step-icon">ğŸ”—</span>æ•´åˆè³‡æ–™ä¸­â€¦</div>
  </div>
</div>

<!-- â”€â”€ é é¦– â”€â”€ -->
<header>
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
    <div>
      <h1>ğŸ“š åœ‹èªå­—éŸ³å½¢å‚™èª²æœå°‹å¼•æ“</h1>
      <p>å‹•æ…‹è®€å–æœ€æ–°è³‡æ–™ Â· å¿«é€Ÿæ‰¾åˆ°è€ƒé»ã€å­¸ç”Ÿè¿·æ€èˆ‡æ•™å­¸ç­–ç•¥</p>
    </div>
    <a href="èª²å ‚è¬›ç¾©.html"
       style="display:inline-block;padding:8px 18px;background:rgba(255,255,255,.2);
              color:white;border-radius:8px;text-decoration:none;font-size:.88rem;
              font-weight:600;border:1px solid rgba(255,255,255,.4);white-space:nowrap"
       onmouseover="this.style.background='rgba(255,255,255,.35)'"
       onmouseout="this.style.background='rgba(255,255,255,.2)'">
      ğŸ“ åˆ‡æ›åˆ°èª²å ‚è¬›ç¾© â†’
    </a>
  </div>
</header>

<!-- â”€â”€ ç¯©é¸åˆ— â”€â”€ -->
<div class="filter-bar">
  <div class="fg">
    <label>å¹´ç´š</label>
    <select id="fGrade"><option value="">å…¨éƒ¨å¹´ç´š</option></select>
  </div>
  <div class="fg">
    <label>å¹´åº¦</label>
    <select id="fYear"><option value="">å…¨éƒ¨å¹´åº¦</option></select>
  </div>
  <div class="fg">
    <label>é¡åˆ¥</label>
    <select id="fCat"><option value="">å…¨éƒ¨é¡åˆ¥</option></select>
  </div>
  <div class="fg">
    <label>é›£æ˜“åº¦</label>
    <select id="fDiff">
      <option value="">å…¨éƒ¨</option>
      <option value="åŸºç¤">åŸºç¤</option>
      <option value="ä¸­éš">ä¸­éš</option>
      <option value="é€²éš">é€²éš</option>
    </select>
  </div>
  <div class="fg">
    <label>ğŸ”</label>
    <input class="search-input" id="fKw" type="text" placeholder="è¼¸å…¥é—œéµå­—â€¦">
  </div>
  <button class="btn-reset" onclick="reset()">æ¸…é™¤æ¢ä»¶</button>
</div>

<!-- â”€â”€ çµ±è¨ˆåˆ— â”€â”€ -->
<div class="stats-bar">
  é¡¯ç¤º <span class="count" id="cnt">0</span> ç­†
  <span id="totalHint" style="color:#9ca3af"></span>
</div>

<!-- â”€â”€ ä¸»å…§å®¹ â”€â”€ -->
<main><div class="card-grid" id="grid"></div></main>

<script>
/* â•â• è¨­å®š â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SHEET_ID = '1MoZ0VhgJ9fSWktZUjunX1IMJwDuFBP_qyZFuEnH6uGo';
const TABS = {
  q:  'é¡Œç›®ä¸»è¡¨',
  m:  'æ•™æè³‡æ–™åº«',
  py: 'ç ´éŸ³å­—ç´°ç›®',
  cz: 'éŒ¯åˆ¥å­—ç´°ç›®',
  xj: 'å½¢è¿‘å­—ç´°ç›®',
};
const csvUrl = name =>
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(name)}`;

/* â•â• å…¨åŸŸè³‡æ–™ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ALL = [], SHOWN = [];

/* â•â• å·¥å…· â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const $ = id => document.getElementById(id);
const esc = s => String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

function setStep(n, state) { // state: 'active' | 'done'
  const el = $('s'+n);
  if (!el) return;
  el.className = 'step ' + state;
  const icon = el.querySelector('.step-icon');
  icon.textContent = state === 'done' ? 'âœ…' : state === 'active' ? 'â³' : icon.textContent;
}

function fetch_csv(name) {
  return new Promise((ok, err) =>
    Papa.parse(csvUrl(name), {
      download: true, header: true, skipEmptyLines: true,
      complete: r => ok(r.data), error: e => err(e)
    })
  );
}

function gradeClass(g) {
  return { 'ä¸‰å¹´ç´š':'b-g3','å››å¹´ç´š':'b-g4','äº”å¹´ç´š':'b-g5','å…­å¹´ç´š':'b-g6' }[g] || 'b-yr';
}
function diffClass(d) {
  return { 'åŸºç¤':'b-ez','ä¸­éš':'b-md','é€²éš':'b-hd' }[d] || 'b-yr';
}

/* â•â• è¼‰å…¥è³‡æ–™ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadData() {
  try {
    [1,2,3,4,5].forEach(n => setStep(n,'active'));

    const [q, m, py, cz, xj] = await Promise.all([
      fetch_csv(TABS.q).then(d=>{ setStep(1,'done'); return d; }),
      fetch_csv(TABS.m).then(d=>{ setStep(2,'done'); return d; }),
      fetch_csv(TABS.py).then(d=>{ setStep(3,'done'); return d; }),
      fetch_csv(TABS.cz).then(d=>{ setStep(4,'done'); return d; }),
      fetch_csv(TABS.xj).then(d=>{ setStep(5,'done'); return d; }),
    ]);

    setStep(6,'active');

    // æ•™æ map
    const matMap = {};
    m.forEach(r => matMap[r['æ•™æç·¨è™Ÿ']] = r);

    // ç´°ç›® map (by é¡Œç›®ID)
    const pyMap={}, czMap={}, xjMap={};
    py.forEach(r=>{ (pyMap[r['é¡Œç›®ID']]||(pyMap[r['é¡Œç›®ID']]=[])).push(r); });
    cz.forEach(r=>{ (czMap[r['é¡Œç›®ID']]||(czMap[r['é¡Œç›®ID']]=[])).push(r); });
    xj.forEach(r=>{ (xjMap[r['é¡Œç›®ID']]||(xjMap[r['é¡Œç›®ID']]=[])).push(r); });

    // æ•´åˆ
    ALL = q.map(row => ({
      ...row,
      _mat: matMap[row['å°æ‡‰æ•™æç·¨è™Ÿ']] || null,
      _py:  pyMap[row['é¡Œç›®ID']]  || [],
      _cz:  czMap[row['é¡Œç›®ID']]  || [],
      _xj:  xjMap[row['é¡Œç›®ID']]  || [],
    }));

    setStep(6,'done');

    // å¡«å……é¸å–®
    fillSelects();

    // æ¸²æŸ“
    applyFilter();

    $('loading').style.display = 'none';
    $('totalHint').textContent = `ï¼ˆè³‡æ–™åº«å…± ${ALL.length} é“é¡Œç›®ï¼‰`;

  } catch(err) {
    $('loading').innerHTML = `
      <div class="error-screen">
        <div class="icon">âš ï¸</div>
        <div style="font-size:1rem;font-weight:600">è³‡æ–™è¼‰å…¥å¤±æ•—</div>
        <div style="font-size:.85rem;color:#6b7280">
          è«‹ç¢ºèª Google Sheets å·²è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„äººå¯ä»¥æª¢è¦–ã€</div>
        <div style="font-size:.75rem;color:#9ca3af;margin-top:4px">${esc(String(err))}</div>
      </div>`;
  }
}

/* â•â• å¡«å……é¸å–® â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fillSelects() {
  const uniq = (arr, key) => [...new Set(arr.map(d=>d[key]).filter(Boolean))];
  const grades = uniq(ALL,'å¹´ç´š').sort();
  const years  = uniq(ALL,'å¹´åº¦').sort((a,b)=>b-a);
  const cats   = uniq(ALL,'é¡åˆ¥').sort();

  grades.forEach(v => $('fGrade').innerHTML += `<option value="${esc(v)}">${esc(v)}</option>`);
  years.forEach(v  => $('fYear').innerHTML  += `<option value="${esc(v)}">${esc(v)} å¹´åº¦</option>`);
  cats.forEach(v   => $('fCat').innerHTML   += `<option value="${esc(v)}">${esc(v)}</option>`);
}

/* â•â• ç¯©é¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyFilter() {
  const grade = $('fGrade').value;
  const year  = $('fYear').value;
  const cat   = $('fCat').value;
  const diff  = $('fDiff').value;
  const kw    = $('fKw').value.trim().toLowerCase();

  SHOWN = ALL.filter(q => {
    if (grade && q['å¹´ç´š']       !== grade) return false;
    if (year  && q['å¹´åº¦']       !== year)  return false;
    if (cat   && q['é¡åˆ¥']       !== cat)   return false;
    if (diff  && q['é›£æ˜“åº¦åˆ†ç´š'] !== diff)  return false;
    if (kw) {
      const haystack = ['é¡Œç›®é‡é»','å­¸ç”Ÿè¿·æ€','æ•™å­¸ç­–ç•¥','å®Œæ•´é¡Œç›®èˆ‡é¸é …',
                        'è¨˜æ†¶è¨£ç«…','è®€éŸ³å€åˆ†æ‘˜è¦','æ•™æåç¨±']
        .map(f => q[f]||'').join(' ').toLowerCase();
      if (!haystack.includes(kw)) return false;
    }
    return true;
  });

  $('cnt').textContent = SHOWN.length;
  render();
}

function reset() {
  ['fGrade','fYear','fCat','fDiff'].forEach(id => $(id).value = '');
  $('fKw').value = '';
  applyFilter();
}

/* â•â• æ¸²æŸ“å¡ç‰‡ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const grid = $('grid');
  if (!SHOWN.length) {
    grid.innerHTML = `<div class="empty"><div class="icon">ğŸ”</div>
      <p>æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„é¡Œç›®ï¼Œè«‹å˜—è©¦èª¿æ•´ç¯©é¸æ¢ä»¶</p></div>`;
    return;
  }
  grid.innerHTML = SHOWN.map((q,i) => card(q, i)).join('');
}

function card(q, i) {
  const id = q['é¡Œç›®ID'] || i;
  const diffB = q['é›£æ˜“åº¦åˆ†ç´š']
    ? `<span class="badge ${diffClass(q['é›£æ˜“åº¦åˆ†ç´š'])}">${esc(q['é›£æ˜“åº¦åˆ†ç´š'])}</span>` : '';

  const pyHtml = pySection(q._py);
  const czHtml = czSection(q._cz);
  const xjHtml = xjSection(q._xj);
  const detailHtml = pyHtml + czHtml + xjHtml;
  const matHtml = q._mat ? matSection(q._mat) : '';

  return `
<div class="card">
  <div class="card-head">
    <span class="badge ${gradeClass(q['å¹´ç´š'])}">${esc(q['å¹´ç´š'])}</span>
    <span class="badge b-yr">${esc(q['å¹´åº¦'])} å¹´</span>
    <span class="badge b-yr">ç¬¬ ${esc(q['é¡Œè™Ÿ'])} é¡Œ</span>
    ${q['é¡åˆ¥'] ? `<span class="badge b-ct">${esc(q['é¡åˆ¥'])}</span>` : ''}
    ${diffB}
    <div class="card-title">${esc(q['é¡Œç›®é‡é»'])}</div>
  </div>

  <div class="card-body">
    ${q['å®Œæ•´é¡Œç›®èˆ‡é¸é …'] ? `
    <div class="sec">
      <div class="sec-lbl">ğŸ“ å®Œæ•´é¡Œç›®èˆ‡é¸é …</div>
      <div class="q-box">${esc(q['å®Œæ•´é¡Œç›®èˆ‡é¸é …'])}</div>
    </div>` : ''}

    ${q['å­¸ç”Ÿè¿·æ€'] ? `
    <div class="sec">
      <div class="sec-lbl">ğŸ’¡ å­¸ç”Ÿå¸¸è¦‹è¿·æ€</div>
      <div class="box-y">${esc(q['å­¸ç”Ÿè¿·æ€'])}</div>
    </div>` : ''}

    ${q['æ•™å­¸ç­–ç•¥'] ? `
    <div class="sec">
      <div class="sec-lbl">ğŸ¯ æ•™å­¸ç­–ç•¥èˆ‡æ­¥é©Ÿ</div>
      <div class="box-g">${esc(q['æ•™å­¸ç­–ç•¥'])}</div>
    </div>` : ''}

    ${q['è¨˜æ†¶è¨£ç«…'] ? `
    <div class="sec">
      <div class="sec-lbl">ğŸ§  è¨˜æ†¶è¨£ç«…</div>
      <div class="box-b">${esc(q['è¨˜æ†¶è¨£ç«…'])}</div>
    </div>` : ''}

    ${q['è®€éŸ³å€åˆ†æ‘˜è¦'] ? `
    <div class="sec">
      <div class="sec-lbl">ğŸ”¤ è®€éŸ³å€åˆ†</div>
      <div class="box-b">${esc(q['è®€éŸ³å€åˆ†æ‘˜è¦'])}</div>
    </div>` : ''}
  </div>

  ${detailHtml ? `
  <button class="exp-btn" onclick="toggle('d${id}',this)">
    <span>ğŸ“‹ é¸é …ç´°ç›®å±•é–‹</span><span class="arrow">â–¼</span>
  </button>
  <div class="exp-body" id="d${id}">${detailHtml}</div>` : ''}

  ${matHtml ? `
  <button class="exp-btn" onclick="toggle('m${id}',this)">
    <span>ğŸ“š å°æ‡‰æ•™æï¼š${esc(q['æ•™æåç¨±'] || q['å°æ‡‰æ•™æç·¨è™Ÿ'])}</span>
    <span class="arrow">â–¼</span>
  </button>
  <div class="exp-body" id="m${id}">${matHtml}</div>` : ''}
</div>`;
}

/* â•â• ç´°ç›®å€å¡Š â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pySection(rows) {
  if (!rows.length) return '';
  return `
  <div style="margin-bottom:10px">
    <div class="sec-lbl" style="margin-bottom:5px">ç ´éŸ³å­—å„é¸é …</div>
    <table class="tbl">
      <thead><tr><th>ä¾†æº</th><th>ç ´éŸ³å­—</th><th>è©èª</th><th>æ³¨éŸ³</th><th>å­—ç¾©</th></tr></thead>
      <tbody>${rows.map(r=>`
        <tr>
          <td>${esc(r['ä¾†æº'])}</td>
          <td><strong>${esc(r['ç ´éŸ³å­—'])}</strong></td>
          <td>${esc(r['è©èª'])}</td>
          <td>${esc(r['æ³¨éŸ³'])}</td>
          <td>${esc(r['å­—ç¾©èªªæ˜'])}</td>
        </tr>`).join('')}
      </tbody>
    </table>
  </div>`;
}

function czSection(rows) {
  if (!rows.length) return '';
  return `
  <div style="margin-bottom:10px">
    <div class="sec-lbl" style="margin-bottom:5px">éŒ¯åˆ¥å­—å„é¸é …</div>
    <table class="tbl">
      <thead><tr><th>æ­£èª¤</th><th>å¥å­ä¸­çš„å¯«æ³•</th><th>æ­£ç¢ºè©èª</th><th>å­—ç¾©èªªæ˜</th></tr></thead>
      <tbody>${rows.map(r=>`
        <tr class="${(r['æ­£èª¤']||'').includes('âœ“') ? 'row-ok' : 'row-err'}">
          <td>${esc(r['æ­£èª¤'])}</td>
          <td>${esc(r['éŒ¯èª¤å¯«æ³•'])}</td>
          <td>${esc(r['æ­£ç¢ºè©èª'])}</td>
          <td>${esc(r['å­—ç¾©èªªæ˜'])}</td>
        </tr>`).join('')}
      </tbody>
    </table>
  </div>`;
}

function xjSection(rows) {
  if (!rows.length) return '';
  return `
  <div>
    <div class="sec-lbl" style="margin-bottom:5px">å½¢è¿‘å­— / åŒéŸ³å­—</div>
    <table class="tbl">
      <thead><tr><th>å­—</th><th>èªè©</th><th>è§£é‡‹</th></tr></thead>
      <tbody>${rows.map(r=>`
        <tr>
          <td><strong>${esc(r['å­—'])}</strong></td>
          <td>${esc(r['èªè©'])}</td>
          <td>${esc(r['è§£é‡‹'])}</td>
        </tr>`).join('')}
      </tbody>
    </table>
  </div>`;
}

function matSection(m) {
  const rows = [
    ['æ ¸å¿ƒå­¸ç¿’é ˜åŸŸ', m['æ ¸å¿ƒå­¸ç¿’é ˜åŸŸ']],
    ['æ•™å­¸é‡é»æ‘˜è¦', m['æ•™å­¸é‡é»æ‘˜è¦']],
    ['æ•™å­¸æ´»å‹•è¨­è¨ˆ', m['ä¸»è¦æ•™å­¸æ´»å‹•è¨­è¨ˆ']],
    ['å‚™èª²é‡é»æé†’', m['å‚™èª²é‡é»æé†’']],
  ].filter(([,v]) => v);
  return `
  <div class="mat-card">
    <div class="mat-title">${esc(m['æ•™æåç¨±'])}
      <span style="font-weight:400;font-size:.78rem;color:#6b7280">ï¼ˆ${esc(m['æ•™æç·¨è™Ÿ'])}ï¼‰</span>
    </div>
    ${rows.map(([k,v]) => `
      <div class="mat-row"><strong>${k}ï¼š</strong>${esc(v)}</div>`).join('')}
  </div>`;
}

/* â•â• å±•é–‹/æ”¶åˆ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggle(id, btn) {
  const el = $(id);
  if (!el) return;
  const open = el.classList.toggle('open');
  btn.classList.toggle('open', open);
}

/* â•â• äº‹ä»¶ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
['fGrade','fYear','fCat','fDiff'].forEach(id => $(id).addEventListener('change', applyFilter));
$('fKw').addEventListener('input', applyFilter);

/* â•â• å•Ÿå‹• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
loadData();
</script>
</body>
</html>
